
{% extends "base.html" %}

{% block title %}Admin Panel - Advanced OwO Bot Dashboard{% endblock %}

{% block content %}
<div class="card glass" style="margin-bottom: 30px;">
    <h2 style="color: #ffffff; margin-bottom: 20px; display: flex; align-items: center; gap: 15px;">
        <i class="fas fa-shield-alt" style="color: #ff6b6b;"></i>
        Admin Control Panel
    </h2>
</div>

<div class="grid grid-2">
    <!-- System Control -->
    <div class="card glass">
        <h3 style="margin-bottom: 20px; color: #ffffff; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-cogs" style="color: #45b7d1;"></i>
            System Control
        </h3>
        
        <form action="/restart" method="post" style="margin-bottom: 15px;">
            <input type="hidden" name="secret" value="{{ admin_secret }}">
            <button type="submit" class="nav-item glass" style="border: none; cursor: pointer; width: 100%; text-align: center; background: rgba(255, 107, 107, 0.2);">
                <i class="fas fa-redo"></i> Restart Bot
            </button>
        </form>
        
        <button class="nav-item glass" style="border: none; cursor: pointer; width: 100%; text-align: center; margin-bottom: 15px;" onclick="clearLogs()">
            <i class="fas fa-trash"></i> Clear Logs
        </button>
        
        <button class="nav-item glass" style="border: none; cursor: pointer; width: 100%; text-align: center;" onclick="backupData()">
            <i class="fas fa-download"></i> Backup Data
        </button>
    </div>

    <!-- Live CPU Monitor -->
    <div class="card glass">
        <h3 style="margin-bottom: 20px; color: #ffffff; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-microchip" style="color: #96ceb4;"></i>
            System Performance
        </h3>
        <canvas id="cpuChart" width="200" height="200"></canvas>
        <div style="margin-top: 15px;">
            <p>Uptime: <span id="uptime">{{ uptime }}</span></p>
            <p>Memory: <span id="memory">{{ memory_usage }}%</span></p>
        </div>
    </div>
</div>

<!-- Live Command Feed -->
<div class="card glass" style="margin-top: 30px;">
    <h3 style="margin-bottom: 20px; color: #ffffff; display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-terminal" style="color: #9b59b6;"></i>
        Live Command Feed
    </h3>
    <div id="command-feed" style="height: 300px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; font-family: monospace;">
        <!-- Commands will appear here -->
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
<script>
    // CPU Gauge Chart
    const cpuCtx = document.getElementById('cpuChart').getContext('2d');
    const cpuChart = new Chart(cpuCtx, {
        type: 'doughnut',
        data: {
            labels: ['Used', 'Free'],
            datasets: [{
                data: [{{ cpu_usage }}, 100 - {{ cpu_usage }}],
                backgroundColor: ['#ff4757', '#2f3542'],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            cutout: '70%'
        }
    });

    // Socket.IO for live updates
    const socket = io();
    
    socket.on('command_log', function(data) {
        const feed = document.getElementById('command-feed');
        const logEntry = document.createElement('div');
        logEntry.className = 'log-entry';
        logEntry.style.cssText = 'padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); color: #ffffff;';
        logEntry.innerHTML = `<span style="color: #45b7d1;">[${data.time}]</span> <span style="color: #96ceb4;">${data.user}:</span> <span style="color: #ff4757;">!${data.command}</span>`;
        feed.appendChild(logEntry);
        feed.scrollTop = feed.scrollHeight;
        
        // Keep only last 50 entries
        if (feed.children.length > 50) {
            feed.removeChild(feed.firstChild);
        }
    });

    socket.on('system_update', function(data) {
        document.getElementById('uptime').textContent = data.uptime;
        document.getElementById('memory').textContent = data.memory + '%';
        
        // Update CPU chart
        cpuChart.data.datasets[0].data = [data.cpu, 100 - data.cpu];
        cpuChart.update();
    });

    // Admin functions
    function clearLogs() {
        document.getElementById('command-feed').innerHTML = '';
    }

    function backupData() {
        fetch('/api/backup')
            .then(response => response.blob())
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = 'bot_backup.json';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
            });
    }
</script>
{% endblock %}
